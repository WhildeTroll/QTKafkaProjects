#!/bin/bash

# Проверка аргументов
if [ $# -lt 1 ]; then
    echo "Использование: $0 <файл> [аргументы...]"
    echo "Пример: $0 Consumer1"
    echo "Пример: $0 ./Consumer2 --param value"
    exit 1
fi

TARGET="$1"
shift  # Убираем первый аргумент (название файла)

# Проверяем существование файла
if [ ! -f "$TARGET" ]; then
    # Пробуем добавить ./ если путь относительный
    if [[ "$TARGET" != /* ]] && [[ "$TARGET" != ./* ]]; then
        TARGET="./$TARGET"
    fi
    
    if [ ! -f "$TARGET" ]; then
        echo "Ошибка: файл '$1' не найден"
        exit 1
    fi
fi

# Проверяем права на выполнение
if [ ! -x "$TARGET" ]; then
    echo "Предупреждение: файл не исполняемый, пытаемся установить права..."
    chmod +x "$TARGET" 2>/dev/null || {
        echo "Ошибка: не удалось установить права на выполнение"
        exit 1
    }
fi

# Запускаем файл с переданными аргументами
exec "$TARGET" "$@"
